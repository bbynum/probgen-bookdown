# Combinations {#combinations}

```{r, message=FALSE, warning=FALSE, echo=FALSE}
library(mosaic)
library(animation)
set.seed(2018)
```

## Introduction {#introduction}

While permutations count ordered arrangements, combinations are unordered collections of items.


## Chapter Scenario - Three Counting Problems and an Algebra Problem {#chapter_scenario_three_counting_problems}

Below are three counting problems and one algebra problem. On the surface these appear to be unrelated problems but can you find a deep connection between them? It might help to team up with classmates to gain multiple perspectives. 

Problem 1: Write down all the possible birth orderings for a family of three boys and two girls (for example, BGBBG is one of them).

Problem 2: Find the number of ways that you can walk along the blocks from point A to point B by a path of shortest length.

```{r nice-fig-101, fig.cap='Block-walking Scenario', out.width='30%', fig.asp=.75, fig.align='center', echo=FALSE}
knitr::include_graphics("01-basics-figures/block_walking_scenario.png")
```

Problem 3: How many ways could two captains be chosen from the five starting members of a basketball team?

Problem 4: Expand the following: $(p + q)^{5}$.

## Example - From Class Line-up to Class Committee {#example_class_lineup_to_class_committee}

If we were to select four people from our class of 20 and line them up, this could be done $P(20,4)=20!/16!=20 \cdot 19 \cdot 18 \cdot 17$ ways. But if we are interested in the number of unordered committees of four rather than ordered line-ups we notice that for each selection of four people, there were $4!=4 \cdot 3 \cdot 2 \cdot 1$ line-ups counted so the number of unordered committees is $(20 \cdot 19 \cdot 18 \cdot 17)/(4 \cdot 3 \cdot 2 \cdot 1)$. 

We call an undordered collection of k objects selected from n distinct objects a combination and use the notation $\dbinom{n}{k}$. A simple way to think of this is to find the permutation of k objects selected from n objects, $P(n,k)=n!/(n-k)!$ and divide out the order, $k!$. Putting all this together we get the following formula.

## Combination Formula

The number of unordered collections of k objects selected from n distinct objects is 

$$\dbinom{n}{k}=\frac{P(n,k)}{k!}=\frac{n!}{(n-k)!k!}=
\frac{n(n-1)(n-2)...(n-k+1)}{k(k-1)(k-2)...3 \cdot 2 \cdot 1}$$

Using this notation to recap the number of unordered committees selected from 20 students we see

$$\dbinom{20}{4}=\frac{20!}{16! \cdot 4!}=\frac{20 \cdot 19 \cdot 18 \cdot 17}{4 \cdot 3 \cdot 2 \cdot 1}$$

## Chapter Scenario Revisited - Three Counting Problems and an Algebra Problem

After tackling these problems one at a time, we will search for underlying links between them.

### Problem 1 - Birth Orderings
Write down all the possible birth orderings for a family of three boys and two girls (for example, BGBBG is one of them).

#### Solution 1 - Brute Force
Letting B represent a boy birth and G a girl birth and putting two B's and three G's in a sequence allows us to list all the possible birth orderings. To do this in a systematic way we can list them in alphabetical order and see there are 10 different birth orderings of two boys and three girls.

* BBBGG
* BBGBG
* BBGGB
* BGBBG
* BGBGB
* BGBBG
* GBBBG
* GBBGB
* GBGBB
* GGBBB

#### Solution 2 - Combinations
We can view the problem of identifying a particular birth ordering of two boys and three girls as selecting the birth order position of the two boys or the birth order position of the three girls. Selecting the birth order position of the two boys is equivalent to selecting an unordered collection of two numbers from the set identifying the five birth order positions, {1,2,3,4,5}. This can be done $\dbinom{5}{2}=\frac{5!}{3! \cdot 2!}=10$ ways. Equivalently, selecting the birth order position of the three girls is equivalent to selecting an unordered collection of three numbers from the set {1,2,3,4,5} which can be done $\dbinom{5}{3}=\frac{5!}{2! \cdot 3!}=10$ ways, arriving at the same solution.


### Problem 2: 
Find the number of ways that you can walk along the blocks from point A to point B by a path of shortest length.

```{r nice-fig-102, fig.cap='Block-walking Scenario', out.width='30%', fig.asp=.75, fig.align='center', echo=FALSE}
knitr::include_graphics("01-basics-figures/block_walking_scenario.png")
```

#### Solution 1 - Brute Force

We can illustrate the 10 different paths of shortest length from A to B.

```{r nice-fig-103, fig.cap='Block-walking Solutions', out.width='30%', fig.asp=.75, fig.align='center', echo=FALSE}
#knitr::include_graphics("01-basics-figures/block_walking_solutions.png")
```

#### Solution 2 - Combinations

If we identify the directions one can travel as down (D) or across (A), then a path of shortest length from A to B is a five-block walk described as a sequence of two D's and three A's. Again, we could choose which of the five blocks are the two down blocks as the number of unordered collection of two objects chosen from {1,2,3,4,5} which is $\dbinom{5}{2}=\frac{5!}{3! \cdot 2!}=10$ or, equivalently, thinking about the across blocks, the number of unordered collection of three objects chosen from {1,2,3,4,5} which is $\dbinom{5}{3}=\frac{5!}{2! \cdot 3!}=10$.

In solving the problem using a combinations perspective we see that under the surface, Problems 1 and 2 are equivalent.

### Problem 3: 
How many ways could two captains be chosen from the five starting members of a basketball team?

#### Solution 1 - Brute Force

Numbering the players 1,2,3,4, and 5 and selecting two of them to be captains results in the following ten possibilities:

* 1,2
* 1,3
* 1,4
* 1,5
* 2,3
* 2,4
* 2,5
* 3,4
* 3,5
* 4,5

#### Solution 2 - Combinations

Given players as members of the set {1,2,3,4,5} we want to select two of them, order not mattering which can be done $\dbinom{5}{2}=\frac{5!}{3! \cdot 2!}=10$ ways. Note, this is equivalent to counting the number of ways we can choose the three non-captains, $\dbinom{5}{3}=\frac{5!}{2! \cdot 3!}=10$.

From this solution, we see that Problems 1, 2, and 3, although from very different real-world contexts, are combinatorially equivalent.

### Problem 4: 
Expand the following: $(p + q)^{5}$.

#### Solution 1 - Brute Force

Traditionally, if we expand the binomial product above using the distributive property (often memorialized as the FOIL method) we arrive at the following terms. It's not fun, and not always safe to try this at home but here are the results.

```{r nice-fig-104, fig.cap='Binomial Expansion', out.width='30%', fig.asp=.75, fig.align='center', echo=FALSE}
#knitr::include_graphics("01-basics-figures/binomial_expansion.png")
```


#### Solution 2 - Combinations

In using the distributive property to multiply out $(a+b)^{5}$, we essentially have to choose a's or b's in each of the five binomial terms. If we focus on the b's, we can choose zero b's which can be done $\dbinom{5}{0}$ ways, one b which can be done $\dbinom{5}{1}$ ways, two b's which can be done $\dbinom{5}{2}$ ways, three b's which can be done $\dbinom{5}{3}$ ways, four b's which can be done $\dbinom{5}{4}$ ways, or five b's which can be done $\dbinom{5}{5}$ ways. This results in the following terms.

$$(a+b)^{5}=\dbinom{5}{0}a^{5} + \dbinom{5}{1}a^{4}b +\dbinom{5}{2}a^{3}b^{2} +\dbinom{5}{3}a^{2}b^{3} +\dbinom{5}{4}ab^{4} +\dbinom{5}{5}b^{5}$$

In general, this result is known as the binomial theorem. The coefficient on the $a^{3}b^{2}$ term can be interpreted as the number of orderings of three a's and two b's, or as a combination $\dbinom{5}{2}$. What may not have been clear to us through all the years of learning algebra is that multiplying out a binomial product is really a combinatorial problem.

## Exercises 

### Exercise - Alphabet
Consider the 26 letters in our alphabet.

(a) How many different three letter strings can we make if repetition of letters is allowed?

(b) How many different three letter strings can we make if repetition of letters is not allowed?

(c) How many ways could three different letters be chosen?

### Exercise - Facts about Combinations

(a) What is $\dbinom{n}{0}$ for all $n \geq 1$?
(b) What is $\dbinom{n}{1}$ for all $n \geq 1$?
(c) What is $\dbinom{n}{n}$ for all $n \geq 1$?
(d) What is the relationship between $\dbinom{n}{k}$ and $\dbinom{n}{n-k}$?

## The Problem of the Points {#problem_of_the_points}


## Chapter Scenario - The BART Series {#chapter_scenario_the_bart_series}

Suppose a game is stopped midway. How should the stakes be split if the game is not complete  but one player is ahead of the other? This famous problem is known as the “Problem of the Points” and stimulated Blaise Pascal to generate some new ideas early in the development of probability theory. In this application we see how our tool of drawing tree diagrams helps us think it through. 

Let’s use baseball as an example. In the Major League Baseball World Series, teams play a series of up to seven games and the first team to win four games wins the series and is declared “world champions” (even though it is just the U.S. and a few Canadian teams). 

An interesting thing happened in the 1989 World Series between the Oakland Athletics and the San Francisco Giants, often called the “Battle of the Bay” or the “BART Series” for the Bay Area Rapid Transit System one would take to the opposite sides of the San Francisco Bay. The Oakland A’s were ahead two games to nothing when the interesting thing happened - an earthquake. Here is how Wikipedia describes it:

"On October 17, just minutes before the start of Game 3, a magnitude 6.9 earthquake struck the Bay Area causing significant damage to both Oakland and San Francisco. Candlestick Park in San Francisco suffered damage to its upper deck as pieces of concrete fell from the baffle at the top of the stadium and the power was knocked out. The game was postponed out of concerns for the safety of everyone in the ballpark as well as the loss of power, with Vincent later saying that he did not know when play would resume." (https://en.wikipedia.org/wiki/1989_World_Series)

Suppose the series had to be permanently suspended at this point. How should the prize money be split? This is essentially an example of the famous “problem of the points.” What do you think would be a fair division of the prize money between the Oakland A’s and the San Francisco Giants? In other words, what percentage of the prize money should the Oakland A’s get and what percentage of the prize money should the San Francisco Giants get? We will use a tree diagram to solve this problem but let's start with a simpler case. 

## A Simpler Case - A Three-Two Split

Suppose the LA Dodgers and the Houston Astros are in the World Series and the Dodgers are ahead of the Astros 3-2. We can use a tree diagram to decide on the fair division of the prize money should the series be suspended at this point.

With five games already played, there are potentially two remaining games which can be described in a tree diagram where D represents a Dodger win and A represents an Astros win. Assuming each team has the same chance of winning a new game, the four branches are equally likely.  If the Dodgers win one more game, they win the series. Three of the four include at least one Dodger win and only one branch shows Houston winning the series, so a fair way to split the prize money would be a 3:1 split with the Dodgers receiving 75% of the prize money and Houston receiving 25%.

Once we are comfortable we can see a shortcut to solve the problem of the points. With two remaining games left and the Dodgers needing only one to win we can examine the second row of Pascal's triangle and identify the appropriate point in the row that represents at least on Dodger win.

$$ \dbinom{2}{0} : \dbinom{2}{1} + \dbinom{2}{2}$$

You may have noticed that if the Dodgers win the next game a seventh game is not played but is included in the tree diagram. The extra branches were included in the diagram so that we could examine equally likely cases. An alternative is to place probabilities on the branches and terminate the tree when the series is over as in the diagram below.

$$P(\text{Dodgers win})=0.5 + 0.5 \cdot 0.5 = 0.75$$
$$P(\text{Astros win})=0.5 \cdot 0.5=0.25$$

Thus, the split should be 75:25 or 3:1 in favor of the Dodgers.

## Chapter Scenario Revisited - The BART Series {#chapter_scenario_revisited_the_bart_series}

In the original problem the Dodgers are ahead of the Astros 2 games to 0 with a potential of 5 remaining games yielding a tree diagram with 32 equally likely outcomes. If the Dodgers win 2 of the games they win the series.

In the tree diagram, there are 26 brances in which the Dodgers win the series and 6 in which the Astros win the series meaning the prize money should be split 26:6 in favor of the Dodgers.

Solving using Pascal's triangle, for the five potential games, if the Dodgers win at least two they win the series.

$$\dbinom{5}{0} + \dbinom{5}{1} : \dbinom{5}{2} + \dbinom{5}{3} + \dbinom{5}{4} + \dbinom{5}{5}$$ 

$$1+5:10+10+5+1 = 6:26$$


### Exercise - A Three:One Split
Suppose the LA Dodgers and the Houston Astros are in the World Series and the Dodgers are ahead of the Astros 3-1. Use a tree diagram to decide on the fair division of the prize money should the series be suspended at this point.

### Exercise - A Three:Zero Split
Suppose the LA Dodgers and the Houston Astros are in the World Series and the Dodgers are ahead of the Astros 3-0. Use combinations and Pascal’s Triangle to decide on the fair division of the prize money should the series be suspended at this point.

## Case Study - Block-walking, Tree Diagrams, and the Quincunx

## Chapter Scenario - The Quincunx {#chapter_scenario_the_quincunx}

A Quincunx, (or Galton Board or Bean Machine), is a board with evenly spaced pegs laid out in a triangular grid as shown in the figure below. A ball is dropped onto the board from a funnel at the top center and bounces its way to the bottom in such a way that each time it hits a peg is has an equal chance of bouncing left or right. At the bottom the balls land in a bin. We want to examine the pattern when numerous balls are sent through the machine.

```{r nice-fig-105, fig.cap='Quincunx or Galton Board', out.width='30%', fig.asp=.75, fig.align='center', echo=FALSE}
knitr::include_graphics("01-basics-figures/galton_board.png")
```

What pattern do you anticipate to see when a large number of balls are sent through the Quincunx? Explain why you think this pattern may emerge.

## The Block-walking Encyclopedia

Below is a diagram of some city blocks. How many ways can a person walk from the top corner to another corner B if she is restricted to paths of minimum length? To explore this question we document the answers at each intersection on the block-walking grid below.  So, imagine that you are starting at the peak and then count how many different paths of shortest length there are from the peak to each intersection and write that number at the intersection. Do you recognize a pattern to these numbers?

```{r nice-fig-106, fig.cap='Block-walking Grid', out.width='30%', fig.asp=.75, fig.align='center', echo=FALSE}
knitr::include_graphics("01-basics-figures/block_walking.png")
```


## Chapter Scenario Revisited - The Quincunx {#chapter_scenario_revisited_the_quincunx}


## Simulation

Yihei Xie included a Quincunx simulation in the `animation` package. 


```{r}
#quincunx(balls = 200, layers = 15, pch.layers = 2, pch.balls = 19, col.balls = sample(colors(), balls, TRUE), cex.balls = 2)
```


### Exercise - Two-stage Quincunx
Suppose that after running 200 balls run through a 15 layer quincunx, they then, from there ending point of this first stage, run through a another second-stage with 15 layers. In what ways would you expect the first layer and second layer results to look similar and in what ways would you expect them to look different? After making your prediction, uncomment and run the R code below and describe ways your predictions were accurate and ways they were inaccurate.

```{r}
#quincunx2(balls = 200, layers = 15, pch.layers = 2, pch.balls = 19, col.balls = sample(colors(), balls, TRUE), cex.balls = 2)
```

### Exercise - Plinko
Plinko is a popular game on The Price is Right. It is similar to a Quincunx where round disk is dropped into the board and is deflected left or right by pegs. It is, however, bounded on each side resulting in some disks being redirected. In the image below you can see there are 12 levels but only 9 possible outcomes. How would you expect the results on this board to be similar or different from an actual 12 level Quincunx? After making your prediction, run the simulation below and describe ways your prediction was accurate and ways your prediction was inaccurate.

```{r nice-fig-107, fig.cap='Price is Right Plinko', out.width='30%', fig.asp=.75, fig.align='center', echo=FALSE}
knitr::include_graphics("01-basics-figures/plinko.png")
```




